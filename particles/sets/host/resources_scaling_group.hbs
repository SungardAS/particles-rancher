---
signalTimeout: PT7M
---
{{set "instance_profile"}}

{{
  resource "host/launch_configuration"
  logicalId="LaunchConfiguration"
  iamInstanceProfile=(
    fnIf
    (scopeId "InstanceProfileRoleIsPopulated")
    (ref "InstanceProfile")
    (ref "AWS::NoValue")
  )
  imageId=imageId
  instanceType=(ref "InstanceType")
  keyName=(ref "KeyPairName")
  rancherAgentImage=(ref "RancherAgentImage")
  rancherRegistrationUrl=(ref "RancherRegistrationUrl")
  securityGroups=(ref "SecurityGroupIds")
  userData=userData
  volumeSize=(ref "VolumeSize")
}}

{{#resource "m:core" "spec"
  type="AWS::AutoScaling::AutoScalingGroup"
  logicalId="AutoScaleGroup"
  LaunchConfigurationName=(ref "LaunchConfiguration")
  DesiredCapacity=(ref "DesiredCapacity")
  MaxSize=(ref "MaxSize")
  MinSize=(ref "MinSize")
  VPCZoneIdentifier=(ref "SubnetIds")
}}
"CreationPolicy": {
  "ResourceSignal": {
    "Count": {{cValue signalCount}},
    "Timeout": {{cValue signalTimeout}}
  }
}
{{/resource}}
