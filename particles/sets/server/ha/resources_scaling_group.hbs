{{set "instance_profile"}}

{{set "server/ha/load_balancing" subnets=vpcZoneIdentifier}}

{{
  resource "server/ha/launch_configuration"
  logicalId="LaunchConfiguration"
  iamInstanceProfile=(
    fnIf
    (scopeId "InstanceProfileRoleIsPopulated")
    (ref "InstanceProfile")
    (ref "AWS::NoValue")
  )
  imageId=imageId
  userData=userData
}}

{{
  resource "m:core" "spec" type="AWS::AutoScaling::AutoScalingGroup"
  logicalId="AutoScaleGroup"
  targetGroupARNs=(concat '[' (ref "LoadBalancerTargetGroup") ']')
}}
