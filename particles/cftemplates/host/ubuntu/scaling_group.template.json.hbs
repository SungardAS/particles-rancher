{{#layout}}

  {{set "host/parameters_ubuntu"}}
  {{set "host/parameters_scaling_group"}}

  {{mapping "ubuntu_ami" logicalId="AmiMap"}}
  {{mapping "ubuntu_versions" logicalId="VersionMap"}}

  {{
    set "host/resources_scaling_group"
    imageId='{"Fn::FindInMap": ["AmiMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["VersionMap", {"Ref": "DockerVersion"}, "osRelease"]} ]}'
    signalCount=(ref "DesiredCapacity")
    userData=(
      partial "userdata/ubuntu"
      dockerPackage='{"Fn::FindInMap": ["VersionMap", {"Ref": "DockerVersion"}, "dockerPackage"]}'
      cfnBootstrapTag='{"Fn::FindInMap": ["VersionMap", {"Ref": "DockerVersion"}, "dockerVersion"]}'
      metadataResource="LaunchConfiguration"
      notifyResource="AutoScaleGroup"
    )
  }}

{{/layout}}
