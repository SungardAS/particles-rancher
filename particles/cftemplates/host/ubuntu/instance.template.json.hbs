{{#layout}}

  {{parameter "m:core" "base" logicalId="SubnetId" type="AWS::EC2::Subnet::Id" description="Subnet for the ec2 instance"}}
  {{set "host/parameters_ubuntu"}}

  {{mapping "ubuntu_ami" logicalId="AmiMap"}}

  {{
    resource "host/instance"
    logicalId="Instance"
    imageId='{"Fn::FindInMap": ["AmiMap", {"Ref": "AWS::Region"}, "xenial"]}'
    instanceType=(ref "InstanceType")
    keyName=(ref "KeyPairName")
    rancherAgentImage=(ref "RancherAgentImage")
    rancherRegistrationUrl=(ref "RancherRegistrationUrl")
    securityGroupIds=(ref "SecurityGroupIds")
    subnetId=(ref "SubnetId")
    userData=(
      partial "userdata/ubuntu"
      dockerVersion='1.11'
      metadataResource="Instance"
      notifyResource="Instance"
    )
    volumeSize=(ref "VolumeSize")
  }}

{{/layout}}
