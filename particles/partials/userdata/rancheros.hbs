---
configSets: default
stackName: '{"Ref": "AWS::StackName"}'
dockerVersion: 1.11
---
{ "Fn::Base64": { "Fn::Join": ["", [
  "#cloud-config\n",
  "rancher:\n",
  "  environment:\n",
  {{
    partial "m:core" "fn_if"
    conditionId="Is050Compatible"
    trueValue="    RESIZE_DEV: /dev/xvda\n"
    falseValue=""
  }},
  "  services_include:\n",
  "    kernel-headers: true\n",
  {{
    partial "m:core" "fn_if"
    conditionId="Is050Compatible"
    trueValue="    https://raw.githubusercontent.com/rancher/os-services/v0.4.5/r/resize-fs.yml: true\n"
    falseValue=""
  }},
  "  services:\n",
  "    aws-cfn-bootstrap:\n",
  "      image: sungardas/aws-cfn-bootstrap:",{{helper "m:core" "propertyValue" dockerVersion}},"\n",
  "      volumes:\n",
  "        - /var/run/docker.sock:/var/run/docker.sock\n",
  "      environment:\n",
  "        CFN_METADATA_RESOURCE: ", {{helper "m:core" "propertyValue" metadataResource}},"\n",
  "        CFN_NOTIFY_RESOURCE: ", {{helper "m:core" "propertyValue" notifyResource}},"\n",
  "        CFN_CONFIG_SETS: ", {{helper "m:core" "propertyValue" configSets}},"\n",
  "        CFN_STACK_NAME: ", {{helper "m:core" "propertyValue" stackName}},"\n",
  "        AWS_REGION: ",{"Ref": "AWS::Region"},"\n",
  "        AWS_DEFAULT_REGION: ",{"Ref": "AWS::Region"},"\n"
]]}}

